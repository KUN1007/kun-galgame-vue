{"version":3,"sources":["index.js"],"names":["getFilesAndDirectoriesFromDirectory","getAsFileSystemHandleFromEntry","entry","logDropError","kind","isFile","isDirectory","undefined","name","getFile","Promise","resolve","reject","file","values","directoryReader","createReader","entries","onSuccess","dirEntries","map","createPromiseToAddFileOrParseDirectory","relativePath","handle","getFilesFromDataTransfer","dataTransfer","all","Array","from","items","item","lastResortFile","getAsFile","getAsFileSystemHandle","webkitGetAsEntry","err"],"mappings":"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","sourcesContent":["import getFilesAndDirectoriesFromDirectory from './getFilesAndDirectoriesFromDirectory.js'\n\n/**\n * Interop between deprecated webkitGetAsEntry and standard getAsFileSystemHandle.\n */\nfunction getAsFileSystemHandleFromEntry (entry, logDropError) {\n  if (entry == null) return entry\n  return {\n    // eslint-disable-next-line no-nested-ternary\n    kind: entry.isFile ? 'file' : entry.isDirectory ? 'directory' : undefined,\n    name: entry.name,\n    getFile () {\n      return new Promise((resolve, reject) => entry.file(resolve, reject))\n    },\n    async* values () {\n      // If the file is a directory.\n      const directoryReader = entry.createReader()\n      const entries = await new Promise(resolve => {\n        getFilesAndDirectoriesFromDirectory(directoryReader, [], logDropError, {\n          onSuccess: (dirEntries) => resolve(dirEntries.map(file => getAsFileSystemHandleFromEntry(file, logDropError))),\n        })\n      })\n      yield* entries\n    },\n  }\n}\n\nasync function* createPromiseToAddFileOrParseDirectory (entry, relativePath) {\n  // For each dropped item, - make sure it's a file/directory, and start deepening in!\n  if (entry.kind === 'file') {\n    const file = await entry.getFile()\n    if (file !== null) {\n      file.relativePath = relativePath ? `${relativePath}/${entry.name}` : null\n      yield file\n    }\n  } else if (entry.kind === 'directory') {\n    for await (const handle of entry.values()) {\n      yield* createPromiseToAddFileOrParseDirectory(handle, `${relativePath}/${entry.name}`)\n    }\n  }\n}\n\nexport default async function* getFilesFromDataTransfer (dataTransfer, logDropError) {\n  const entries = await Promise.all(Array.from(dataTransfer.items, async item => {\n    const lastResortFile = item.getAsFile() // Chromium bug, see https://github.com/transloadit/uppy/issues/3505.\n    const entry = await item.getAsFileSystemHandle?.()\n      ?? getAsFileSystemHandleFromEntry(item.webkitGetAsEntry(), logDropError)\n\n    return { lastResortFile, entry }\n  }))\n\n  for (const { lastResortFile, entry } of entries) {\n    // :entry can be null when we drop the url e.g.\n    if (entry != null) {\n      try {\n        yield* createPromiseToAddFileOrParseDirectory(entry, '')\n      } catch (err) {\n        if (lastResortFile) {\n          yield lastResortFile\n        } else {\n          logDropError(err)\n        }\n      }\n    }\n  }\n}\n"]}